<div class="content">
    <div class="doc">
        <div class="index">
            <ul class="index-list">
                <li><a routerLink="/aws/como-empezar" routerLinkActive="active">Como empezar</a></li>
                <li><a routerLink="/aws/crear-cuenta" routerLinkActive="active">Crear cuenta y capa gratuita</a></li>
                <li class="active">
                    <a class="active-submenu" routerLink="/aws/servicio-s3/como-empezar"
                        routerLinkActive="active">Amazon S3</a>
                    <div class="submenu-container">
                        <hr>
                        <ul class="submenu">
                            <li><a routerLink="/aws/servicio-s3/como-empezar" routerLinkActive="active">Antes de
                                    empezar</a></li>
                            <li class="active"><a routerLink="/aws/servicio-s3/creación-del-proyecto"
                                    routerLinkActive="active">Creación del proyecto</a></li>
                        </ul>
                    </div>
                </li>
            </ul>
        </div>
        <div class="info">
            <div class="title">
                <h1>CRUD usando S3</h1>
                <div class="icons-container">
                    <a href="https://github.com/Alvarosanchezz3/S3-BASIC-CRUD" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" width="90" height="90" viewBox="0 0 24 24"><path fill="#ffffff" d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"/></svg></a>
                    <a href="https://www.linkedin.com/posts/alvaro-sanchez-velez_frontend-backend-aws-activity-7180466902861766656-eF9S?utm_source=share&utm_medium=member_desktop" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" width="90" height="90" viewBox="0 0 24 24"><path fill="#ffffff" d="M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2zm-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93zM6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37z"/></svg></a>
                </div>
            </div>
            <h3>1. Estructura y dependecias del proyecto S3</h3>
            <p class="texto">Vamos a realizar un CRUD (Crear, Leer, Actualizar y Borrar) en Java con Spring. La
                estructura del proyecto es muy sencilla: Básicamente un <span class="text-blue-aws">archivo de
                    configuración de S3</span> y la <span class="text-blue-aws">estructura básica de una API REST</span>
                pero sin entidades ni repositorios ya que no usaremos BBDD. <span class="text-blue-aws"> Usaremos estas
                    3 dependencias</span> (lombok es prescindible) en nuestro pom.xml:</p>
            <div class="image-container">
                <img src="/assets/tecns/aws/S3/CRUD/estructura-paquetes.png" alt="estructura-paquetes">
                <img src="/assets/tecns/aws/S3/CRUD/dependencias-pom.png" alt="estructura-paquetes">
            </div>
            <h3>2. Creación archivo de configuración</h3>
            <p class="texto">Vamos a empezar con la <span class="text-blue-aws">clase de config</span> <span
                    class="text-yellow-aws"> S3Config</span>, en esta pondremos <span class="text-blue-aws">como
                    atributos las claves</span> que hemos creado en el apartado <a
                        routerLink="/aws/servicio-s3/antes-de-empezar" class="enlace-apartado">antes de
                        empezar</a>, ya que son necesarias para el acceso. Las creamos como <span
                    class="text-blue-aws">variables de entorno, ya que son datos sensibles</span> que no queremos que
                nadie sepa.</p>
            <div class="explicacion-codigo1">
                <div class="code-container">
                    <pre>
                        <code>
                        <span class="yellow">&#64;Configuration</span>
                        <span><span class="purple">public class</span> <span class="yellow">S3Config </span>{{"{"}}</span> 
                    
                        <br><span>    <span class="yellow">&#64;Value</span>(<span class="green">"${{"{"}}accesKey{{"}"}}"</span>)</span>
                            <span>    <span class="purple">private</span> <span class="yellow"> String</span><span class="red"> accessKey;</span></span>
                    
                        <br><span>    <span class="yellow">&#64;Value</span>(<span class="green">"${{"{"}}secretKey{{"}"}}"</span>)</span>
                        <span>    <span class="purple">private</span><span class="yellow"> String</span><span class="red"> secretKey;</span></span>
                    
                        <br><span class="yellow">    &#64;Bean</span>
                            <span>    <span class="purple">public</span><span class="yellow"> S3Client</span><span class="blue"> s3Client</span>() {{"{"}}</span>
                            <span>        <span class="yellow">Region</span> region = <span class="yellow">Region</span>.<span class="brown">EU_WEST_3</span>;</span>
                            
                            <span>        <span class="yellow">AwsCredentials</span> credentials = <span class="yellow">AwsBasicCredentials</span>.<span class="blue">create</span>(<span class="red">accessKey</span>, <span class="red">secretKey</span>);</span>
                            
                        <br><span>        <span class="purple">return</span>  <span class="yellow">S3Client</span>.<span class="blue">builder</span>()</span>
                            <span>                .<span class="blue">region</span>(region)</span>
                            <span>                .<span class="blue">credentialsProvider</span>(<span class="yellow">StaticCredentialsProvider</span>.<span class="blue">create</span>(credentials))</span>
                            <span>                .<span class="blue">build</span>();</span>    {{"}"}}<br>{{"}"}}</code>
                    </pre>
                </div>
            </div>
            <h3>3. Creación de funcionalidades</h3>
            <p class="texto">Esta es la <span class="purple">interface</span> del <span
                    class="text-yellow-aws">Service</span>:</p>
            <div class="explicacion-codigo1">
                <div class="code-container">
                    <pre>
                        <code>
                        <span><span class="purple">public interface</span> <span class="yellow">IS3Service</span> {{"{"}}</span>
                    
                        <br><span>    <span class="yellow">ResponseEntity</span>{{"<"}}<span class="yellow">List</span>{{"<"}}<span class="yellow">String</span>{{">"}}{{">"}}<span class="blue"></span> <span class="blue">getAllFiles</span> () <span class="purple">throws</span> <span class="yellow">IOException</span>;</span>

                        <br><span>    <span class="yellow">ResponseEntity</span> <span class="blue">downloadFile</span> (<span class="yellow">String</span> <span class="brown">filename</span>) <span class="purple">throws</span> <span class="yellow">IOException</span>;</span>

                        <br><span>    <span class="yellow">ResponseEntity</span> <span class="blue">uploadFile</span> (<span class="yellow">MultipartFile</span> <span class="brown">file</span>) <span class="purple">throws</span> <span class="yellow">IOException</span>;</span>

                        <br><span>    <span class="yellow">ResponseEntity</span> <span class="blue">renameFile</span> (<span class="yellow">String</span> <span class="brown">oldFileName</span>, <span class="yellow">String</span> <span class="brown">newFileName</span>) <span class="purple">throws</span> <span class="yellow">IOException</span>;</span>

                        <br><span>    <span class="yellow">ResponseEntity</span> <span class="blue">updateFile</span> (<span class="yellow">String</span> <span class="brown">oldFileName</span>, <span class="yellow">MultipartFile</span> <span class="brown">file</span>) <span class="purple">throws</span> <span class="yellow">IOException</span>;</span>

                        <br><span>    <span class="yellow">ResponseEntity</span> <span class="blue">deleteFile</span> (<span class="yellow">String</span> <span class="brown">fileName</span>) <span class="purple">throws</span> <span class="yellow">IOException</span>;</span>

                        <br><span>    <span class="purple">byte</span>[] <span class="blue">downloadFileAsBytes</span>(<span class="yellow">String</span> <span class="brown">fileName</span>) <span class="purple">throws</span> <span class="yellow">IOException</span>;</span><br>{{"}"}}</code>
                    </pre>
                </div>
            </div>
            <p class="texto">Creamos la clase <span class="yellow">S3ServiceImpl </span>, que es la implementación de
                los métodos del Service. En este caso en vez de un Repository, inyectaremos el cliente de S3 que hemos
                creado en el S3Config</p>
            <div class="explicacion-codigo2">
                <div class="code-container">
                    <pre>
                        <code>
                        <span class="yellow">&#64;Data</span>
                        <span class="yellow">&#64;Service</span>
                        <span><span class="purple">public class</span> <span class="yellow">S3ServiceImpl <span class="purple">implements</span> <span class="yellow">IS3Service</span></span> {{"{"}}</span>
                        <span>    <span class="purple">private final</span> <span class="yellow">S3Client</span> <span class="red">s3Client</span>;</span>
                        </code>
                    </pre>
                </div>
            </div>
            <p class="texto"><strong>Estas son las implementaciones de los métodos:</strong></p>
            <div class="slider-container">
                <div class="slider-info">
                    <div class="slider-info1">
                        <ul class="list">
                            <li>
                                <p><strong>-</strong><span class="blue"> objectExists</span>()<strong> → Método para validar si hay objetos con el nombre que le pasamos por parámetro</strong> antes de realizar las acciones que queremos.</p>
                            </li>
                        </ul>
                        <div class="code-container">
                            <pre>
                                <code>
                                    <span><span class="purple">private</span><span class="yellow"> boolean</span><span class="blue"></span> <span class="blue">objectExists</span> (<span class="yellow">String</span> <span class="brown">objectKey</span>) <span class="purple">throws</span> <span class="yellow">IOException</span> {{"{"}}</span>
                                        <span>    <span class="purple">try </span>{{"{"}}</span>
                                            <span>        <span class="yellow">HeadObjectRequest</span> headObjectRequest = <span class="yellow">HeadObjectRequest</span>.<span class="blue">builder</span>();</span>
                                                    <span>                .<span class="blue">bucket</span>(<span class="green">"bucket-prueba--s3"</span>)</span>
                                                    <span>                .<span class="blue">key</span>(fileName);</span>
                                                    <span>                .<span class="blue">build</span>();</span>

                                            <br><span>        <span class="red">s3Client</span>.<span class="blue">headObject</span>(headObjectRequest)</span>

                                        <span>    {{"}"}} <span class="purple">catch</span> (<span class="yellow">S3Exception</span> <span class="brown">e</span>) {{"{"}}</span>
                                            <span>        <span class="purple">if</span> (<span class="brown">e</span>.<span class="blue">statusCode</span>() == <span class="brown">404</span>) {{"{"}}</span>    
                                            <span>            <span class="purple">return false</span>;</span>        {{"}"}}<br>    {{"}"}}<span>    <span class="purple">return true</span>;</span>{{"}"}}</code>
                            </pre>
                        </div>   
                    </div>
                    <div class="slider-info2">
                        <button (click)="previousSlide()"><img src="./assets/icons/arrow-left.png" alt="arrow"></button>
                        <div class="codigo-slider" [class.active]="currentSlide === 0">
                            <ul class="list">
                                <li>
                                    <p><strong>-</strong><span class="blue"> getAllFiles</span>()<strong> → Recupera los nombres de todos los archivos en un bucket de Amazon S3.</strong> Crea un listado de los objetos de S3 y extrae sus nombres y los añade a otra lista usando un bucle for each.</p>
                                </li>
                            </ul>
                            <div class="code-container">
                                <pre>
                                    <code>
                                    <span><span class="purple">public</span><span class="yellow"> ResponseEntity</span>{{"<"}}<span class="yellow">List</span>{{"<"}}<span class="yellow">String</span>{{">"}}{{">"}}<span class="blue"></span> <span class="blue">getAllFiles</span> () <span class="purple">throws</span> <span class="yellow">IOException</span> {{"{"}}</span>
                                        <span><span class="purple">    try </span>{{"{"}}</span>
                                            <span><span class="yellow">        ListObjectsRequest</span> listObjectsRequest = <span class="yellow">ListObjectsRequest</span>.<span class="blue">builder</span>()</span>
                                                    <span>                .<span class="blue">bucket</span>(<span class="green">"bucket-prueba--s3"</span>)</span>
                                                    <span>                .<span class="blue">build</span>();</span>
                                            <br><span><span class="yellow">        List</span>{{"<"}}<span class="yellow">S3Object</span>{{">"}} objects = <span class="red">s3Client</span>.<span class="blue">listObjects</span>(listObjectsRequest).<span class="blue">contents</span>();</span>
                                            <span><span class="yellow">        List</span>{{"<"}}<span class="yellow">String</span>{{">"}} fileNames = <span class="purple">new</span> <span class="yellow">ArrayList</span>{{"<"}}{{">"}}();</span>
        
                                            <br><span><span class="purple">        for</span> (<span class="yellow">S3Object</span> object: objects) {{"{"}}</span>
                                                <span>            fileNames.<span class="blue">add</span>(object.<span class="blue">key</span>());</span>        {{"}"}}<span><span class="purple">        return</span> <span class="yellow">ResponseEntity</span>.<span class="blue">ok</span>(fileNames);</span>
                                            <br><span>    {{"}"}} <span class="purple">catch</span> (<span class="yellow">S3Exception</span> <span class="brown">e</span>) {{"{"}}</span>
                                                <span><span class="purple">        throw new</span> <span class="yellow">IOException</span>(<span class="brown">e</span>.<span class="blue">getMessage</span>());</span>    {{"}"}}<br>{{"}"}}</code>
                                </pre>
                            </div>   
                        </div>
                        <div class="codigo-slider" [class.active]="currentSlide === 1">
                            <ul class="list">
                                <li>
                                    <p><strong>-</strong><span class="blue"> uploadFile</span>()<strong> → Sube un archivo al bucket de Amazon S3.</strong> Obtiene el nombre del archivo que se pasa en el cuerpo de llamada, construye una solicitud para añadir el objeto en el bucket y pasándole esa key (nombre del archivo) y ejecuta esta solicitud.</p>
                                </li>
                            </ul>
                            <div class="code-container">
                                <pre>
                                    <code>
                                        <span><span class="purple">public</span><span class="yellow"> ResponseEntity</span><span class="blue"></span> <span class="blue">uploadFile</span> (<span class="yellow">MultipartFile</span> <span class="brown">file</span>) <span class="purple">throws</span> <span class="yellow">IOException</span> {{"{"}}</span>
                                                                                                    
                                            <span><span class="purple">    try </span>{{"{"}}</span>
                                                <span><span class="yellow">        String</span> fileName = <span class="yellow">file</span>.<span class="blue">getOriginalFilename</span>();</span>
                                                <span><span class="yellow">        PutObjectRequest</span> putObjectRequest = <span class="yellow">PutObjectRequest</span>.<span class="blue">builder</span>()</span>
                                                        <span>                .<span class="blue">bucket</span>(<span class="green">"bucket-prueba--s3"</span>)</span>
                                                        <span>                .<span class="blue">key</span>(fileName);</span>
                                                        <span>                .<span class="blue">build</span>();</span>
        
                                                <br><span><span class="red">        s3Client</span>.<span class="blue">putObject</span>(putObjectRequest, <span class="yellow">RequestBody</span>.<span class="blue">fromBytes</span>(<span class="brown">file</span>.<span class="blue">getBytes</span>()));</span>  
                                                <span><span class="purple">        return</span> <span class="yellow">ResponseEntity</span>.<span class="blue">ok</span>(<span class="green">"Archivo subido correctamente"</span>);</span>
                                                <br><span>    {{"}"}} <span class="purple">catch</span> (<span class="yellow">S3Exception</span> <span class="brown">e</span>) {{"{"}}</span>
                                                    <span><span class="purple">        throw new</span> <span class="yellow">IOException</span>(<span class="brown">e</span>.<span class="blue">getMessage</span>());</span>    {{"}"}}<br>{{"}"}}</code>
                                </pre>
                            </div>   
                        </div>
                        <div class="codigo-slider" [class.active]="currentSlide === 2">
                            <ul class="list">
                                <li>
                                    <p><strong>-</strong><span class="blue"> downloadFileAsBytes</span>()<strong> → Devuelve el archivo directamente.</strong> Recibe el nombre del archivo a descargar, construye una solicitud de obtención de objeto especificando el nombre del bucket y el nombre de archivo como clave. Luego, utiliza el cliente de S3 para obtener el objeto del bucket. Lee los bytes del archivo, lo reconstruye y te lo devuelve</p>
                                </li>
                            </ul>
                            <div class="code-container">
                                <pre>
                                    <code>
                                        <span><span class="purple">public</span><span class="purple"> byte</span>[] <span class="blue">downloadFileAsBytes</span> (<span class="yellow">String</span> <span class="brown">fileName</span>) <span class="purple">throws</span> <span class="yellow">IOException</span> {{"{"}}</span>

                                            <span><span class="yellow">    GetObjectRequest</span> request = <span class="yellow">GetObjectRequest</span>.<span class="blue">builder</span>()</span>
                                                    <span>                .<span class="blue">bucket</span>(<span class="green">"bucket-prueba--s3"</span>)</span>
                                                    <span>                .<span class="blue">key</span>(<span class="brown">fileName</span>)</span>
                                                    <span>                .<span class="blue">build</span>();</span>

                                            <br><span><span class="purple">    try</span> (<span class="yellow">ResponseInputStream</span>{{"<"}}<span class="yellow">GetObjectResponse</span>{{">"}} result = <span class="red">s3Client</span>.<span class="blue">getObject</span>(request)) {{"{"}}</span>
                                                
                                                <span><span class="yellow">        ByteArrayOutputStream</span> outputStream = <span class="purple">new</span> <span class="yellow">ByteArrayOutputStream</span>();</span>
                                                <span><span class="purple">        byte</span>[] buffer = <span class="purple">new byte</span>[<span class="brown">4096</span>];</span>
                                                <span><span class="purple">        int</span> bytesRead;</span>
                                                <br><span><span class="purple">        while</span> ((bytesRead = result.<span class="blue">read</span>(buffer)) != <span class="brown">-1</span>) {{"{"}}</span>
                                                    <span>            outputStream.<span class="blue">write</span>(buffer, <span class="purple">0</span>, bytesRead);</span>        {{"}"}}
                                                <span>        <span class="purple">return</span> outputStream.<span class="blue">toByteArray</span>();</span>
                                            
                                            <span>    {{"}"}} <span class="purple">catch</span> (<span class="yellow">IOException</span> <span class="brown">e</span>) {{"{"}} </span>
                                                <span>        <span class="purple">throw new</span> <span class="yellow">IOException</span>(<span class="green">"Error al descargar el archivo: "</span> + <span class="brown">e</span>.<span class="blue">getMessage</span>());</span>    {{"}"}}<br>{{"}"}}</code>
                                </pre>
                            </div>   
                        </div>
                        <div class="codigo-slider" [class.active]="currentSlide === 3">
                            <ul class="list">
                                <li>
                                    <p><strong>-</strong><span class="blue"> downloadFile</span>()<strong> → Es parecido al</strong> <span class="blue"> downloadFileAsBytes</span>() <strong>pero en este asignamos una ruta para que se descargue ahí el archivo,</strong>  usamos el método para saber si existe y luego leemos los bytes del archivo y creamos uno igual en la ruta que hemos indicado</p>
                                </li>
                            </ul>
                            <div class="code-container">
                                <pre>
                                    <code>
                                        <span><span class="purple">public</span><span class="yellow"> ResponseEntity</span> <span class="blue">downloadFile</span> (<span class="yellow">String</span> <span class="brown">fileName</span>) <span class="purple">throws</span> <span class="yellow">IOException</span> {{"{"}}</span>
                                            
                                            <span>    <span class="yellow">String</span> localPath = <span class="green">"/Users/"</span> + <span class="yellow">System</span>.<span class="blue">getProperty</span>(<span class="green">"user.name"</span>) + <span class="green">"/Downloads/"</span>;</span>

                                            <span>    <span class="purple">if</span> (!<span class="blue">objectExists</span>(<span class="brown">fileName</span>)) {{"{"}}</span>
                                                <span>        <span class="purple">return</span> <span class="yellow">ResponseEntity</span>.<span class="blue">status</span>(<span class="yellow">HttpStatus</span>.<span class="brown">NOT_FOUND</span>)
                                                    .<span class="blue">body</span>(<span class="green">"El archivo '"</span> + <span class="brown">fileName</span> + <span class="green">"' no se encontró."</span>);</span>    {{"}"}}
                                            <span>    <span class="yellow">GetObjectRequest</span> request = <span class="yellow">GetObjectRequest</span>.<span class="blue">builder</span>()</span>
                                                    <span>                .<span class="blue">bucket</span>(<span class="green">"bucket-prueba--s3"</span>)</span>
                                                    <span>                .<span class="blue">key</span>(<span class="brown">fileName</span>)</span>
                                                    <span>                .<span class="blue">build</span>();</span>

                                            <span>    <span class="yellow">ResponseInputStream</span>{{"<"}}<span class="yellow">GetObjectResponse</span>{{">"}} result = <span class="red">s3Client</span>.<span class="blue">getObject</span>(request);</span>

                                            <span>    <span class="purple">try </span>(<span class="yellow">FileOutputStream</span> fileOutputStream = <span class="purple">new</span> <span class="yellow">FileOutputStream</span>(localPath + <span class="brown">fileName</span>)) {{"{"}}</span>
                                                <span>        <span class="purple">byte</span>[] read_buf = <span class="purple">new byte</span>[<span class="brown">1024</span>];</span>
                                                <span>        <span class="purple">int</span> read_len = <span class="brown">0</span>;</span>

                                                <br><span>        <span class="purple">while</span> ((read_len = result.<span class="blue">read</span>(read_buf)) > <span class="brown">0</span>) {{"{"}}</span>
                                                    <span>            <span class="purple">fileOutputStream</span>.<span class="blue">write</span>(read_buf, <span class="brown">0</span>, read_len);</span>        {{"}"}}   
                                            <span>    {{"}"}} <span class="purple">catch</span> (<span class="yellow">IOException</span> <span class="brown">e</span>) {{"{"}}</span>
                                            <span>        <span class="purple">throw new</span> <span class="yellow">IOException</span>(<span class="brown">e</span>.<span class="blue">getMessage</span>());</span>    {{"}"}}<span>    <span class="purple">return</span> <span class="yellow">ResponseEntity</span>.<span class="blue">ok</span>().<span class="blue">body</span>(<span class="green">"Archivo descargado correctamente"</span>);</span>{{"}"}}</code>
                                </pre>
                            </div>   
                        </div>
                        <div class="codigo-slider" [class.active]="currentSlide === 4">
                            <ul class="list">
                                <li>
                                    <p><strong>-</strong><span class="blue"> renameFile</span>()<strong> → Renombra archivos.</strong> Recibe en la ruta el nombre antiguo y el nuevo nombre del archivo a renombrar. Primero, verifica si el archivo antiguo existe en el bucket. Luego, construye una solicitud de copia de objeto especificando el bucket de destino, la ubicación y el nombre del archivo antiguo, así como el nuevo nombre del archivo.</p>
                                </li>
                            </ul>
                            <div class="code-container">
                                <pre>
                                    <code>
                                        <span><span class="purple">public</span><span class="yellow"> ResponseEntity</span><span class="blue"></span> <span class="blue">renameFile</span> (<span class="yellow">String</span> <span class="brown">oldFileName</span>, <span class="yellow">String</span> <span class="brown">newFileName</span>) 
                                                                        <span class="purple">throws</span> <span class="yellow">IOException</span> {{"{"}}</span>
                                            <span>    <span class="purple">if</span> (!<span class="blue">objectExists</span>(<span class="brown">oldFileName</span>)) {{"{"}}</span>
                                                <span>        <span class="purple">return</span> <span class="yellow">ResponseEntity</span>.<span class="blue">status</span>(<span class="yellow">HttpStatus</span>.<span class="brown">NOT_FOUND</span>)
                                                    .<span class="blue">body</span>(<span class="green">"El archivo '"</span> + <span class="brown">fileName</span> + <span class="green">"' no se encontró."</span>);</span>    {{"}"}}
                                            <span>    <span class="purple">try </span>{{"{"}}</span>
                                                <span>        <span class="yellow">CopyObjectRequest</span> copyObjectRequest = <span class="yellow">CopyObjectRequest</span>.<span class="blue">builder</span>()</span>
                                                        <span>                .<span class="blue">destinationBucket</span>(<span class="green">"bucket-prueba--s3"</span>)</span>
                                                        <span>                .<span class="blue">copySource</span>(<span class="green">"bucket-prueba--s3/"</span> + <span class="brown">oldFileName</span>)</span>
                                                        <span>                .<span class="blue">destinationKey</span>(<span class="brown">newFileName</span>);</span>
                                                        <span>                .<span class="blue">build</span>();</span>
        
                                                <br><span>        <span class="red">s3Client</span>.<span class="blue">copyObject</span>(copyObjectRequest);</span>
                                                <span>        <span class="blue">deleteFile</span>(<span class="brown">oldFileName</span>);</span>
        
                                                <br><span>    {{"}"}} <span class="purple">catch</span> (<span class="yellow">S3Exception</span> <span class="brown">e</span>) {{"{"}}</span>
                                                    <span>        <span class="purple">throw new</span> <span class="yellow">IOException</span>(<span class="brown">e</span>.<span class="blue">getMessage</span>());</span>    {{"}"}}<span>    <span class="purple">return</span> <span class="yellow">ResponseEntity</span>.<span class="blue">ok</span>().<span class="blue">body</span>(<span class="green">"Archivo renombrado con éxito a "</span> + <span class="brown">newFileName</span>);</span>{{"}"}}</code>
                                </pre>
                            </div>   
                        </div>
                        <div class="codigo-slider" [class.active]="currentSlide === 5">
                            <ul class="list">
                                <li>
                                    <p><strong>-</strong><span class="blue"> updateFile</span>()<strong> → Actualizamos archivo.</strong> Verificamos si existe el archivo y utilizamos los otros métodos para borrar y subir uno con el nombre del archivo antiguo y el nuevo archivo.</p>
                                </li>
                            </ul>
                            <div class="code-container">
                                <pre>
                                    <code>
                                        <span><span class="purple">public</span><span class="yellow"> ResponseEntity</span><span class="blue"></span> <span class="blue">updateFile</span> (<span class="yellow">String</span> <span class="brown">oldFileName</span>, <span class="yellow">MultipartFile</span> <span class="brown">file</span>) 
                                                                        <span class="purple">throws</span> <span class="yellow">IOException</span> {{"{"}}</span>
                                            <span>    <span class="purple">if</span> (!<span class="blue">objectExists</span>(<span class="brown">oldFileName</span>)) {{"{"}}</span>
                                                <span>        <span class="purple">return</span> <span class="yellow">ResponseEntity</span>.<span class="blue">status</span>(<span class="yellow">HttpStatus</span>.<span class="brown">NOT_FOUND</span>)
                                                    .<span class="blue">body</span>(<span class="green">"El archivo '"</span> + <span class="brown">fileName</span> + <span class="green">"' no se encontró."</span>);</span>    {{"}"}}
                                            <span>    <span class="purple">try </span>{{"{"}}</span>
                                                <span>        <span class="yellow">String</span> newFileName = <span class="brown">file</span>.<span class="blue">getOriginalFilename</span>();</span>
                                                <span>        <span class="blue">deleteFile</span>(<span class="brown">oldFileName</span>);</span>
                                                <span>        <span class="blue">uploadFile</span>(<span class="brown">file</span>);</span>
                                            <span>    {{"}"}} <span class="purple">catch</span> (<span class="yellow">S3Exception</span> <span class="brown">e</span>) {{"{"}}</span>
                                                    <span>        <span class="purple">throw new</span> <span class="yellow">IOException</span>(<span class="brown">e</span>.<span class="blue">getMessage</span>());</span>    {{"}"}}<span>    <span class="purple">return</span> <span class="yellow">ResponseEntity</span>.<span class="blue">ok</span>().<span class="blue">body</span>(<span class="green">"Archivo actualizado correctamente"</span>);</span>{{"}"}}</code>
                                </pre>
                            </div>   
                        </div>
                        <div class="codigo-slider" [class.active]="currentSlide === 6">
                            <ul class="list">
                                <li>
                                    <p><strong>-</strong><span class="blue"> deleteFile</span>()<strong> → Borra un archivo.</strong> Verificamos si existe el archivo y creamos una solicitud de borrado de archivo especificando el bucket y el nombre del archivo y la ejecutamos.</p>
                                </li>
                            </ul>
                            <div class="code-container">
                                <pre>
                                    <code>
                                        <span><span class="purple">public</span><span class="yellow"> ResponseEntity</span> <span class="blue">deleteFile</span> (<span class="yellow">String</span> <span class="brown">fileName</span>) <span class="purple">throws</span> <span class="yellow">IOException</span> {{"{"}}</span>
                                            <span>    <span class="purple">if</span> (!<span class="blue">objectExists</span>(<span class="brown">oldFileName</span>)) {{"{"}}</span>
                                                <span>        <span class="purple">return</span> <span class="yellow">ResponseEntity</span>.<span class="blue">status</span>(<span class="yellow">HttpStatus</span>.<span class="brown">NOT_FOUND</span>)
                                                    .<span class="blue">body</span>(<span class="green">"El archivo '"</span> + <span class="brown">fileName</span> + <span class="green">"' no se encontró."</span>);</span>    {{"}"}}                                            
                                            <span>    <span class="purple">try </span>{{"{"}}</span>
                                                <span>        <span class="yellow">DeleteObjectRequest</span> deleteObjectRequest = <span class="yellow">DeleteObjectRequest</span>.<span class="blue">builder</span>()</span>
                                                    <span>                .<span class="blue">bucket</span>(<span class="green">"bucket-prueba--s3"</span>)</span>
                                                    <span>                .<span class="blue">key</span>(fileName);</span>
                                                    <span>                .<span class="blue">build</span>();</span>

                                                <br><span>        <span class="red">s3Client</span>.<span class="blue">deleteObject</span>(deleteObjectRequest);</span>
                                                <br><span>    {{"}"}} <span class="purple">catch</span> (<span class="yellow">S3Exception</span> <span class="brown">e</span>) {{"{"}}</span>
                                                    <span>        <span class="purple">throw new</span> <span class="yellow">IOException</span>(<span class="brown">e</span>.<span class="blue">getMessage</span>());</span>    {{"}"}}<span>    <span class="purple">return</span> <span class="yellow">ResponseEntity</span>.<span class="blue">ok</span>().<span class="blue">body</span>(<span class="green">"Archivo borrado correctamente"</span>);</span>{{"}"}}</code>
                                </pre>
                            </div>   
                        </div>
                        <button (click)="nextSlide()"><img src="./assets/icons/arrow-right.png" alt="arrow"></button>
                    </div>    
                </div>
                
            </div>
            <h3>4. Creación de los endpoints</h3>
            <p class="texto">Ahora simplemente <span class="text-blue-aws">especificamos los tipos de métodos y las rutas de los endpoints.</span>  (No lo explico aquí porque sería muy largo pero básicamente es hacer un <span class="purple">return</span> del método del service, <span class="text-blue-aws">menos en el caso del </span> <span class="blue">downloadFileAsBytes</span>() que <span class="text-blue-aws">depende del tipo de archivo</span> que queramos obtener en la respuesta, <span class="text-blue-aws">en este caso una imagen JPEG.</span></p>
            <div class="explicacion-codigo1 codigo-grande">
                <div class="code-container">
                    <pre>
                        <code>
                            <span><span class="yellow">&#64;RequestMapping</span>(<span class="green">"/s3"</span>)</span>
                            <span class="yellow">&#64;RestController</span>
                            <span><span class="purple">public class</span> <span class="yellow">S3Controller <span class="purple">implements</span> <span class="yellow">IS3Service</span></span> {{"{"}}</span>
                            
                            <br><span>    <span class="yellow">&#64;Autowired</span></span>
                            <span>    <span class="purple">private</span> <span class="yellow">IS3Service</span> <span class="red">s3Service</span>;</span>
                            
                            <br><span>    <span class="yellow">&#64;GetMapping</span>(<span class="green">"/listFiles"</span>)</span>
                            <span>    <span class="purple">public</span> <span class="yellow">ResponseEntity </span><span class="blue">listFiles</span>() <span class="purple">throws</span> <span class="yellow">IOException</span>  {{"{"}}</span> 
                            <span>        <span class="purple">return</span> <span class="red">s3Service</span>.<span class="blue">getAllFiles</span>();</span>    {{"}"}}
                            <span>    <span class="yellow">&#64;GetMapping</span>(<span class="green">"/download/{{"{"}}fileName{{"}"}}"</span>)</span>
                            <span>    <span class="purple">public</span> <span class="yellow">ResponseEntity </span><span class="blue">downloadFile</span>(<span class="yellow">&#64;PathVariable String</span> <span class="brown">fileName</span>) <span class="purple">throws</span> <span class="yellow">IOException</span>  {{"{"}}</span> 
                            <span>        <span class="purple">return</span> <span class="red">s3Service</span>.<span class="blue">downloadFile</span>(<span class="brown">fileName</span>);</span>    {{"}"}}
                            <span>    <span class="yellow">&#64;GetMapping</span>(<span class="green">"/downloadAsBytes/{{"{"}}fileName{{"}"}}"</span>)</span>
                            <span>    <span class="purple">public</span> <span class="yellow">ResponseEntity</span>{{"<"}}<span class="purple">byte</span>[]{{">"}}<span class="blue">downloadFileAsBytes</span>(<span class="yellow">&#64;PathVariable String</span> <span class="brown">fileName</span>)<br>                                                                                                                <span class="purple">throws</span> <span class="yellow">IOException</span>  {{"{"}}</span> 
                            <span>        <span class="purple">byte</span>[] fileBytes = <span class="red">s3Service</span>.<span class="blue">downloadFileAsBytes</span>(<span class="brown">fileName</span>);</span>

                            <span>        <span class="yellow">HttpHeaders</span> headers = <span class="purple">new</span> <span class="yellow">HttpHeaders</span>();</span>
                            <span>        headers.<span class="blue">setContentType</span>(<span class="yellow">MediaType</span>.<span class="brown">IMAGE_JPEG</span>);</span>
                            <br><span>        <span class="purple">return</span> <span class="yellow">ResponseEntity</span>.<span class="blue">ok</span>().<span class="blue">headers</span>(headers).<span class="blue">body</span>(fileBytes);</span>    {{"}"}}
                            <span>    <span class="yellow">&#64;PostMapping</span>(<span class="green">"/upload"</span>)</span>
                            <span>    <span class="purple">public</span> <span class="yellow">ResponseEntity </span><span class="blue">uploadFile</span>(<span class="yellow">&#64;RequestParam </span>(<span class="green">"file"</span>) <span class="yellow">MultipartFile</span> <span class="brown">fileName</span>)<br>                                                                            <span class="purple">throws</span> <span class="yellow">IOException</span>  {{"{"}}</span> 
                            <span>        <span class="purple">return</span> <span class="red">s3Service</span>.<span class="blue">uploadFile</span>(<span class="brown">fileName</span>);</span>    {{"}"}}
                            <span>    <span class="yellow">&#64;PutMapping</span>(<span class="green">"/rename/{{"{"}}oldFileName{{"}"}}/{{"{"}}newFileName{{"}"}}"</span>)</span>
                            <span>    <span class="purple">public</span> <span class="yellow">ResponseEntity </span><span class="blue">renameFile</span>(<span class="yellow">&#64;PathVariable String</span> <span class="brown">oldFileName</span>,  <br>                                                                          <span class="yellow">&#64;PathVariable String</span> <span class="brown">newFileName</span>)<span class="purple">throws</span> <span class="yellow">IOException</span>  {{"{"}}</span> 
                            <br><span>        <span class="purple">return</span> <span class="red">s3Service</span>.<span class="blue">renameFile</span>(<span class="brown">oldFileName</span>, <span class="brown">newFileName</span>);</span>    {{"}"}}
                            <span>    <span class="yellow">&#64;PutMapping</span>(<span class="green">"/update/{{"{"}}oldFileName{{"}"}}"</span>)</span>
                            <span>    <span class="purple">public</span> <span class="yellow">ResponseEntity </span><span class="blue">updateFile</span>(<span class="yellow">&#64;PathVariable String</span> <span class="brown">oldFileName</span>, <br>                                                                          <span class="yellow">&#64;RequestParam</span>(<span class="green">"file"</span>) <span class="yellow">MultipartFile</span> <span class="brown">file</span>) <span class="purple">throws</span> <span class="yellow">IOException</span>  {{"{"}}</span> 
                            <br><span>        <span class="purple">return</span> <span class="red">s3Service</span>.<span class="blue">updateFile</span>(<span class="brown">oldFileName</span>, <span class="brown">file</span>);</span>    {{"}"}}
                            <span>    <span class="yellow">&#64;DeleteMapping</span>(<span class="green">"/delete/{{"{"}}fileName{{"}"}}"</span>)</span>
                            <span>    <span class="purple">public</span> <span class="yellow">ResponseEntity </span><span class="blue">deleteFile</span>(<span class="yellow">&#64;PathVariable String</span> <span class="brown">fileName</span>) <span class="purple">throws</span> <span class="yellow">IOException</span>  {{"{"}}</span> 
                            <span>        <span class="purple">return</span> <span class="red">s3Service</span>.<span class="blue">deleteFile</span>(<span class="brown">fileName</span>);</span>    {{"}"}}</code>
                    </pre>
                </div>
            </div>
        </div>
    </div>
</div>